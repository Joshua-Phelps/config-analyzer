[
  {
    "name": "accidental-public-storage",
    "description": "Finds Storage Accounts with a Private Endpoint configured but the public endpoint is still enabled",
    "type": "ResourceGraph",
    "query": "Resources | where type=~ 'Microsoft.Storage/storageAccounts' and isnotempty(properties.privateEndpointConnections[0]) and properties.networkAcls.defaultAction=~ 'Allow'",
    "recommendation": "https://github.com/noelbundick/config-analyzer/tree/main/docs/built-in-rules"
  },
  {
    "name": "accidental-public-storage",
    "description": "Finds Storage Accounts with a Private Endpoint configured but the public endpoint is still enabled",
    "type": "ARM",
    "recommendation": "https://github.com/noelbundick/config-analyzer/tree/main/docs/built-in-rules",
    "evaluation": {
      "query": "type == `Microsoft.Storage/storageAccounts` && properties.networkAcls.defaultAction == `Allow`",
      "and": [
        {
          "query": "type == `Microsoft.Storage/storageAccounts/privateEndpointConnections` && starts_with(name, `{{parent.name}}/`)"
        }
      ]
    }
  },
  {
    "name": "function-app",
    "description": "",
    "type": "ARM",
    "evaluation": {
      "query": "type == `Microsoft.Web/sites`",
      "request": {
        "type": "config/appsettings/list",
        "apiVersion": "2018-02-01",
        "query": "properties.WEBSITE_DNS_SERVER != `168.63.129.16` && properties.WEBSITE_VNET_ROUTE_ALL != 1"
      },
      "and": [
        {
          "query": "type == `Microsoft.Web/sites/virtualNetworkConnections` && starts_with(name, `{{parentName}}`/)"
        }
      ]
    }
  }
]